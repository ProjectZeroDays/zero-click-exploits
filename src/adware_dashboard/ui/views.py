from flask import Flask, render_template
from adware_dashboard.api.routes import create_api_app
from adware_dashboard.core.adware_manager import AdwareManager
from adware_dashboard.core.payload_manager import PayloadManager
from adware_dashboard.core.deployment_manager import DeploymentManager
from adware_dashboard.core.ai_integration import AIIntegration
from adware_dashboard.models import create_tables
import logging

logger = logging.getLogger(__name__)

create_tables()

payload_manager = PayloadManager(logger)
deployment_manager = DeploymentManager(logger)
ai_integration = AIIntegration(logger, ai_model_endpoint="http://localhost:5001/generate")
adware_manager = AdwareManager(logger, payload_manager, deployment_manager)

def create_ui_app() -> Flask:
    """
    Creates and configures the Flask UI application.

    Returns:
        Flask: The configured Flask application.
    """
    app = Flask(__name__, template_folder='templates', static_folder='static')

    @app.route('/')
    def index():
        """
        Renders the main dashboard page.
        """
        return render_template('index.html')

    return app

api_app = create_api_app(logger, adware_manager, payload_manager, deployment_manager, ai_integration)
ui_app = create_ui_app()

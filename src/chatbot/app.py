from flask import Flask, render_template, request, jsonify
from network_scanner import scan_network
from vulnerability_assessor import assess_vulnerabilities
from exploit_deployer import deploy_exploit
import openai

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/scan_network', methods=['POST'])
def scan_network_endpoint():
    devices = scan_network()
    vulnerabilities = assess_vulnerabilities(devices)
    return jsonify(vulnerabilities)

@app.route('/deploy_exploit', methods=['POST'])
def deploy_exploit_endpoint():
    target = request.json.get('target')
    result = deploy_exploit(target)
    return jsonify({"result": result})

@app.route('/copilot', methods=['POST'])
def copilot_endpoint():
    user_input = request.json.get('user_input')
    response = get_copilot_response(user_input)
    return jsonify({"response": response})

def get_copilot_response(user_input):
    openai.api_key = "YOUR_OPENAI_API_KEY"
    response = openai.Completion.create(
        engine="text-davinci-003",
        prompt=user_input,
        max_tokens=150
    )
    return response.choices[0].text.strip()

if __name__ == "__main__":
    app.run(debug=True)

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trojan Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { font-family: 'Arial', sans-serif; }
        .loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin: -8px 0 0 -8px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col min-h-screen">
    <header class="bg-gray-800 text-white py-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <img alt="CIA logo, a circular emblem with an eagle in the center and the words 'Central Intelligence Agency' around the edge" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/M3goJkmASo5JPxLEfnXwv5NePo7x0ZeAGdeMR0oc07s0NQiQB.jpg" width="40"/>
                <span class="text-xl font-bold">CIA Special Activities Division</span>
            </div>
            <nav class="space-x-4">
                <a class="hover:underline" href="index.html">Main Dashboard</a>
                <a class="hover:underline" href="#">Home</a>
                <a class="hover:underline" href="#">About</a>
                <a class="hover:underline" href="#">Contact</a>
            </nav>
            <div class="flex space-x-2">
                <a class="bg-white text-gray-800 rounded-full p-2" href="#"><i class="fab fa-facebook-f"></i></a>
                <a class="bg-white text-gray-800 rounded-full p-2" href="#"><i class="fab fa-twitter"></i></a>
                <a class="bg-white text-gray-800 rounded-full p-2" href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </header>
    <main class="flex-grow flex items-center justify-center">
        <div class="bg-gray-800 text-white rounded-lg shadow-lg p-8 w-full max-w-md">
            <div class="flex justify-center mb-6">
                <img alt="CIA logo, a circular emblem with an eagle in the center and the words 'Central Intelligence Agency' around the edge" class="w-24 h-24" height="100" src="https://storage.googleapis.com/a1aa/image/M3goJkmASo5JPxLEfnXwv5NePo7x0ZeAGdeMR0oc07s0NQiQB.jpg" width="100"/>
            </div>
            <h1 class="text-2xl font-bold text-center mb-4">Special Activities Division</h1>
            <h2 class="text-xl font-semibold text-center mb-6">Trojan Dashboard</h2>
            <form>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" for="username">Username</label>
                    <input class="w-full px-3 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="username" placeholder="Enter your username" type="text"/>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="password">Password</label>
                    <input class="w-full px-3 py-2 bg-gray-700 text-white rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="password" placeholder="Enter your password" type="password"/>
                </div>
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <input class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="remember" type="checkbox"/>
                        <label class="ml-2 block text-sm" for="remember">Remember me</label>
                    </div>
                    <a class="text-sm text-blue-500 hover:underline" href="#">Forgot password?</a>
                </div>
                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" type="submit">Login</button>
            </form>
            <div class="text-center mt-6">
                <a class="text-sm text-blue-500 hover:underline" href="#">Device Passkey</a>
                <span class="mx-2">|</span>
                <a class="text-sm text-blue-500 hover:underline" href="#">Physical Passkey</a>
            </div>
        </div>
    </main>
    <footer class="bg-gray-800 text-white py-4">
        <div class="container mx-auto text-center">
            <nav class="space-x-4">
                <a class="hover:underline" href="index.html">Main Dashboard</a>
                <a class="hover:underline" href="analytics_dashboard.html">Analytics Dashboard</a>
                <a class="hover:underline" href="c2_panel.html">C2 Panel</a>
                <a class="hover:underline" href="chatbot_dashboard.html">Chatbot Dashboard</a>
                <a class="hover:underline" href="feature_pages.html">Feature Pages</a>
                <a class="hover:underline" href="osint_tools_dashboard.html">OSINT Tools Dashboard</a>
                <a class="hover:underline" href="rat_dashboard.html">RAT Dashboard</a>
                <a class="hover:underline" href="rss_dashboard.html">RSS Dashboard</a>
                <a class="hover:underline" href="shodan_dashboard.html">Shodan Dashboard</a>
                <a class="hover:underline" href="simplenote_dashboard.html">SimpleNote Dashboard</a>
                <a class="hover:underline" href="trojan_dashboard.html">Trojan Dashboard</a>
                <a class="hover:underline" href="zenmap_dashboard.html">Zenmap Dashboard</a>
            </nav>
            <p class="text-sm">&copy; 2023 ProjectZeroDays. All rights reserved.</p>
        </div>
    </footer>
    <script>
        const API_BASE_URL = '/api/trojan'; // Backend API endpoint
        let apiKey = localStorage.getItem('apiKey') || '';
        document.getElementById('apiKey').value = apiKey;

        function saveApiKey() {
            apiKey = document.getElementById('apiKey').value;
            localStorage.setItem('apiKey', apiKey);
            alert('API Key saved!');
        }

        async function createTrojanServer(event) {
            event.preventDefault();
            const serverIP = document.getElementById('serverIP').value;
            const serverPort = document.getElementById('serverPort').value;
            const encryptionMethod = document.getElementById('encryptionMethod').value;
            const deploymentMethod = document.getElementById('serverDeploymentMethod').value;
            const createButton = document.querySelector('#createTrojanServerForm button');

            if (!serverIP || !serverPort) {
                document.getElementById('createServerResult').textContent = 'Error: Server IP and Port are required.';
                document.getElementById('createServerResult').classList.add('error');
                return;
            }

            createButton.classList.add('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/servers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-API-Key': apiKey },
                    body: JSON.stringify({ server_ip: serverIP, server_port: parseInt(serverPort), encryption_method: encryptionMethod, deployment_method: deploymentMethod })
                });
                const data = await response.json();
                if (response.ok) {
                    document.getElementById('createServerResult').textContent = 'Trojan server created successfully: ' + JSON.stringify(data, null, 2);
                    document.getElementById('createServerResult').classList.remove('error');
                    document.getElementById('createServerResult').classList.add('success');
                    listTrojanServers(); // Update the list after creating a server
                } else {
                    document.getElementById('createServerResult').textContent = 'Error creating trojan server: ' + JSON.stringify(data, null, 2);
                    document.getElementById('createServerResult').classList.add('error');
                    document.getElementById('createServerResult').classList.remove('success');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('createServerResult').textContent = 'Error creating trojan server: ' + error;
                document.getElementById('createServerResult').classList.add('error');
                document.getElementById('createServerResult').classList.remove('success');
            } finally {
                createButton.classList.remove('loading');
            }
        }

        async function createTrojanClient(event) {
            event.preventDefault();
            const clientConfig = document.getElementById('clientConfig').value;
            const deploymentMethod = document.getElementById('clientDeploymentMethod').value;
            const createButton = document.querySelector('#createTrojanClientForm button');

            if (!clientConfig) {
                document.getElementById('createClientResult').textContent = 'Error: Client config is required.';
                document.getElementById('createClientResult').classList.add('error');
                return;
            }

            createButton.classList.add('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/clients`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-API-Key': apiKey },
                    body: JSON.stringify({ config: JSON.parse(clientConfig), deployment_method: deploymentMethod })
                });
                const data = await response.json();
                if (response.ok) {
                     document.getElementById('createClientResult').textContent = 'Trojan client created successfully: ' + JSON.stringify(data, null, 2);
                    document.getElementById('createClientResult').classList.remove('error');
                    document.getElementById('createClientResult').classList.add('success');
                    listTrojanClients(); // Update the list after creating a client
                } else {
                    document.getElementById('createClientResult').textContent = 'Error creating trojan client: ' + JSON.stringify(data, null, 2);
                    document.getElementById('createClientResult').classList.add('error');
                    document.getElementById('createClientResult').classList.remove('success');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('createClientResult').textContent = 'Error creating trojan client: ' + error;
                document.getElementById('createClientResult').classList.add('error');
                 document.getElementById('createClientResult').classList.remove('success');
            } finally {
                createButton.classList.remove('loading');
            }
        }

        async function generateTrojanAI(event) {
            event.preventDefault();
            const aiGoal = document.getElementById('aiGoal').value;
            const aiConstraints = document.getElementById('aiConstraints').value;
            const generateButton = document.querySelector('#generateTrojanAIForm button');

            if (!aiGoal) {
                document.getElementById('generateAIResult').textContent = 'Error: AI Goal is required.';
                document.getElementById('generateAIResult').classList.add('error');
                return;
            }

            generateButton.classList.add('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-API-Key': apiKey },
                    body: JSON.stringify({ goal: aiGoal, constraints: JSON.parse(aiConstraints || '{}') })
                });
                const data = await response.json();
                document.getElementById('generateAIResult').textContent = 'AI generated trojan config: ' + JSON.stringify(data, null, 2);
                document.getElementById('generateAIResult').classList.remove('error');
                document.getElementById('generateAIResult').classList.add('success');
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('generateAIResult').textContent = 'Error generating trojan config with AI: ' + error;
                document.getElementById('generateAIResult').classList.add('error');
                document.getElementById('generateAIResult').classList.remove('success');
            } finally {
                generateButton.classList.remove('loading');
            }
        }

        async function listTrojanServers() {
            const listButton = document.querySelector('#trojanServerListContainer').previousElementSibling;
            listButton.classList.add('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/servers`, {
                    headers: { 'X-API-Key': apiKey }
                });
                const data = await response.json();
                if (response.ok) {
                    let tableHTML = '<table class="w-full text-left"><thead><tr><th class="border-b">ID</th><th class="border-b">Server IP</th><th class="border-b">Server Port</th><th class="border-b">Encryption Method</th><th class="border-b">Deployment Method</th><th class="border-b">Actions</th></tr></thead><tbody>';
                    data.forEach(server => {
                        tableHTML += `<tr><td class="border-b">${server.id}</td><td class="border-b">${server.server_ip}</td><td class="border-b">${server.server_port}</td><td class="border-b">${server.encryption_method || ''}</td><td class="border-b">${server.deployment_method || ''}</td><td class="border-b"><button onclick="deployTrojanServer(${server.id})" class="bg-blue-500 px-2 py-1 rounded">Deploy</button><div id="deploymentFeedbackServer${server.id}" class="deployment-feedback"></div></td></tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    document.getElementById('trojanServerListContainer').innerHTML = tableHTML;
                    document.getElementById('trojanServerListContainer').classList.remove('error');
                } else {
                    document.getElementById('trojanServerListContainer').textContent = 'Error listing trojan servers: ' + JSON.stringify(data, null, 2);
                    document.getElementById('trojanServerListContainer').classList.add('error');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('trojanServerListContainer').textContent = 'Error listing trojan servers: ' + error;
                document.getElementById('trojanServerListContainer').classList.add('error');
            } finally {
                listButton.classList.remove('loading');
            }
        }

        async function listTrojanClients() {
            const listButton = document.querySelector('#trojanClientListContainer').previousElementSibling;
            listButton.classList.add('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/clients`, {
                    headers: { 'X-API-Key': apiKey }
                });
                const data = await response.json();
                if (response.ok) {
                    let tableHTML = '<table class="w-full text-left"><thead><tr><th class="border-b">ID</th><th class="border-b">Config</th><th class="border-b">Deployment Method</th><th class="border-b">Actions</th></tr></thead><tbody>';
                    data.forEach(client => {
                        tableHTML += `<tr><td class="border-b">${client.id}</td><td class="border-b">${JSON.stringify(client.config)}</td><td class="border-b">${client.deployment_method || ''}</td><td class="border-b"><button onclick="deployTrojanClient(${client.id})" class="bg-blue-500 px-2 py-1 rounded">Deploy</button><div id="deploymentFeedbackClient${client.id}" class="deployment-feedback"></div></td></tr>`;
                    });
                    tableHTML += '</tbody></table>';
                    document.getElementById('trojanClientListContainer').innerHTML = tableHTML;
                    document.getElementById('trojanClientListContainer').classList.remove('error');
                } else {
                    document.getElementById('trojanClientListContainer').textContent = 'Error listing trojan clients: ' + JSON.stringify(data, null, 2);
                    document.getElementById('trojanClientListContainer').classList.add('error');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('trojanClientListContainer').textContent = 'Error listing trojan clients: ' + error;
                document.getElementById('trojanClientListContainer').classList.add('error');
            } finally {
                listButton.classList.remove('loading');
            }
        }

        async function deployTrojanServer(serverId) {
            const feedbackDiv = document.getElementById(`deploymentFeedbackServer${serverId}`);
            feedbackDiv.textContent = 'Deployment pending...';
            feedbackDiv.classList.add('pending');

            try {
                const response = await fetch(`${API_BASE_URL}/servers/${serverId}/deploy`, {
                    method: 'POST',
                    headers: { 'X-API-Key': apiKey }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    feedbackDiv.textContent = `Deployment failed: ${errorData.message || 'Unknown error'}`;
                    feedbackDiv.classList.remove('pending');
                    feedbackDiv.classList.add('error');
                    return;
                }

                feedbackDiv.textContent = 'Deployment in progress...';
                feedbackDiv.classList.remove('pending');
                feedbackDiv.classList.add('in-progress');

                // Start polling for deployment status
                startDeploymentPolling(serverId, 'server', feedbackDiv);

            } catch (error) {
                console.error('Error deploying server:', error);
                feedbackDiv.textContent = `Deployment failed: ${error}`;
                feedbackDiv.classList.remove('pending');
                feedbackDiv.classList.add('error');
            }
        }

        async function deployTrojanClient(clientId) {
            const feedbackDiv = document.getElementById(`deploymentFeedbackClient${clientId}`);
            feedbackDiv.textContent = 'Deployment pending...';
            feedbackDiv.classList.add('pending');

            try {
                const response = await fetch(`${API_BASE_URL}/clients/${clientId}/deploy`, {
                    method: 'POST',
                    headers: { 'X-API-Key': apiKey }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    feedbackDiv.textContent = `Deployment failed: ${errorData.message || 'Unknown error'}`;
                    feedbackDiv.classList.remove('pending');
                    feedbackDiv.classList.add('error');
                    return;
                }

                feedbackDiv.textContent = 'Deployment in progress...';
                feedbackDiv.classList.remove('pending');
                feedbackDiv.classList.add('in-progress');

                // Start polling for deployment status
                startDeploymentPolling(clientId, 'client', feedbackDiv);

            } catch (error) {
                console.error('Error deploying client:', error);
                feedbackDiv.textContent = `Deployment failed: ${error}`;
                feedbackDiv.classList.remove('pending');
                feedbackDiv.classList.add('error');
            }
        }

        function startDeploymentPolling(id, type, feedbackDiv) {
            const interval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/${type}s/${id}/status`, {
                        headers: { 'X-API-Key': apiKey }
                    });
                    const data = await response.json();

                    if (data.status === 'success') {
                        feedbackDiv.textContent = 'Deployment successful!';
                        feedbackDiv.classList.remove('in-progress');
                        feedbackDiv.classList.add('success');
                        clearInterval(interval);
                    } else if (data.status === 'error') {
                        feedbackDiv.textContent = `Deployment failed: ${data.message || 'Unknown error'}`;
                        feedbackDiv.classList.remove('in-progress');
                        feedbackDiv.classList.add('error');
                        clearInterval(interval);
                    }
                } catch (error) {
                    console.error('Error polling deployment status:', error);
                    feedbackDiv.textContent = `Error polling deployment status: ${error}`;
                    feedbackDiv.classList.remove('in-progress');
                    feedbackDiv.classList.add('error');
                    clearInterval(interval);
                }
            }, 5000); // Poll every 5 seconds
        }
    </script>
</body>
</html>

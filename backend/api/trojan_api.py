from flask import Blueprint, request, jsonify
from backend.app import db, require_api_key
from backend.models.trojan_server import TrojanServer
from backend.models.trojan_client import TrojanClient
import logging

logger = logging.getLogger(__name__)

trojan_bp = Blueprint('trojan', __name__, url_prefix='/api/trojan')

@trojan_bp.route('/servers/<int:server_id>/status', methods=['GET'])
@require_api_key
def get_trojan_server_status(server_id):
    server = TrojanServer.query.get_or_404(server_id)
    return jsonify({'id': server.id, 'server_ip': server.server_ip, 'server_port': server.server_port,
                    'encryption_method': server.encryption_method, 'deployment_method': server.deployment_method,
                    'deployment_status': server.deployment_status, 'deployment_message': server.deployment_message,
                    'deployment_details': server.deployment_details})

@trojan_bp.route('/clients/<int:client_id>/status', methods=['GET'])
@require_api_key
def get_trojan_client_status(client_id):
    client = TrojanClient.query.get_or_404(client_id)
    return jsonify({'id': client.id, 'config': client.config, 'deployment_method': client.deployment_method,
                    'deployment_status': client.deployment_status, 'deployment_message': client.deployment_message,
                    'deployment_details': client.deployment_details})
